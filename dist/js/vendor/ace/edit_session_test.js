/* ***** BEGIN LICENSE BLOCK *****
 * Version: MPL 1.1/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 1.1 (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * The Original Code is Ajax.org Code Editor (ACE).
 *
 * The Initial Developer of the Original Code is
 * Ajax.org B.V.
 * Portions created by the Initial Developer are Copyright (C) 2010
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 *      Fabian Jakobs <fabian AT ajax DOT org>
 *      Julian Viereck <julian DOT viereck AT gmail DOT com>
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 2 or later (the "GPL"), or
 * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** */

typeof process!="undefined"&&(require("amd-loader"),require("./test/mockdom")),define(["require","exports","module","./lib/lang","./edit_session","./editor","./undomanager","./test/mockrenderer","./range","./test/assertions","./mode/javascript"],function(e,t,n){function c(){var e=["function foo(items) {","    for (var i=0; i<items.length; i++) {",'        alert(items[i] + "juhu");',"    }    // Real Tab.","}"],t=new i(e.join("\n"));return t.setUndoManager(new o),t.addFold("args...",new a(0,13,0,18)),t.addFold("foo...",new a(1,10,2,10)),t.addFold("bar...",new a(2,20,2,25)),t}var r=e("./lib/lang"),i=e("./edit_session").EditSession,s=e("./editor").Editor,o=e("./undomanager").UndoManager,u=e("./test/mockrenderer").MockRenderer,a=e("./range").Range,f=e("./test/assertions"),l=e("./mode/javascript").Mode;n.exports={"test: find matching opening bracket in Text mode":function(){var e=new i(["(()(","())))"]);f.position(e.findMatchingBracket({row:0,column:3}),0,1),f.position(e.findMatchingBracket({row:1,column:2}),1,0),f.position(e.findMatchingBracket({row:1,column:3}),0,3),f.position(e.findMatchingBracket({row:1,column:4}),0,0),f.equal(e.findMatchingBracket({row:1,column:5}),null)},"test: find matching closing bracket in Text mode":function(){var e=new i(["(()(","())))"]);f.position(e.findMatchingBracket({row:1,column:1}),1,1),f.position(e.findMatchingBracket({row:1,column:1}),1,1),f.position(e.findMatchingBracket({row:0,column:4}),1,2),f.position(e.findMatchingBracket({row:0,column:2}),0,2),f.position(e.findMatchingBracket({row:0,column:1}),1,3),f.equal(e.findMatchingBracket({row:0,column:0}),null)},"test: find matching opening bracket in JavaScript mode":function(){var e=["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str (a string) to the console","        console.log(str);","    }",'    str += " bar() }";',"}"],t=new i(e.join("\n"),new l);f.position(t.findMatchingBracket({row:0,column:14}),0,12),f.position(t.findMatchingBracket({row:7,column:1}),0,15),f.position(t.findMatchingBracket({row:6,column:20}),1,15),f.position(t.findMatchingBracket({row:1,column:22}),1,20),f.position(t.findMatchingBracket({row:3,column:31}),3,21),f.position(t.findMatchingBracket({row:4,column:24}),4,19),f.equal(t.findMatchingBracket({row:0,column:1}),null)},"test: find matching closing bracket in JavaScript mode":function(){var e=["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str (a string) to the console","        console.log(str);","    }",'    str += " bar() }";',"}"],t=new i(e.join("\n"),new l);f.position(t.findMatchingBracket({row:0,column:13}),0,13),f.position(t.findMatchingBracket({row:0,column:16}),7,0),f.position(t.findMatchingBracket({row:1,column:16}),6,19),f.position(t.findMatchingBracket({row:1,column:21}),1,21),f.position(t.findMatchingBracket({row:3,column:22}),3,30),f.position(t.findMatchingBracket({row:4,column:20}),4,23)},"test: handle unbalanced brackets in JavaScript mode":function(){var e=["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str a string) to the console","        console.log(str);","    ",'    str += " bar() ";',"}"],t=new i(e.join("\n"),new l);f.equal(t.findMatchingBracket({row:0,column:16}),null),f.equal(t.findMatchingBracket({row:3,column:30}),null),f.equal(t.findMatchingBracket({row:1,column:16}),null)},"test: match different bracket types":function(){var e=new i(["({[",")]}"]);f.position(e.findMatchingBracket({row:0,column:1}),1,0),f.position(e.findMatchingBracket({row:0,column:2}),1,2),f.position(e.findMatchingBracket({row:0,column:3}),1,1),f.position(e.findMatchingBracket({row:1,column:1}),0,0),f.position(e.findMatchingBracket({row:1,column:2}),0,2),f.position(e.findMatchingBracket({row:1,column:3}),0,1)},"test: move lines down":function(){var e=new i(["a1","a2","a3","a4"]);e.moveLinesDown(0,1),f.equal(e.getValue(),["a3","a1","a2","a4"].join("\n")),e.moveLinesDown(1,2),f.equal(e.getValue(),["a3","a4","a1","a2"].join("\n")),e.moveLinesDown(2,3),f.equal(e.getValue(),["a3","a4","a1","a2"].join("\n")),e.moveLinesDown(2,2),f.equal(e.getValue(),["a3","a4","a2","a1"].join("\n"))},"test: move lines up":function(){var e=new i(["a1","a2","a3","a4"]);e.moveLinesUp(2,3),f.equal(e.getValue(),["a1","a3","a4","a2"].join("\n")),e.moveLinesUp(1,2),f.equal(e.getValue(),["a3","a4","a1","a2"].join("\n")),e.moveLinesUp(0,1),f.equal(e.getValue(),["a3","a4","a1","a2"].join("\n")),e.moveLinesUp(2,2),f.equal(e.getValue(),["a3","a1","a4","a2"].join("\n"))},"test: duplicate lines":function(){var e=new i(["1","2","3","4"]);e.duplicateLines(1,2),f.equal(e.getValue(),["1","2","3","2","3","4"].join("\n"))},"test: duplicate last line":function(){var e=new i(["1","2","3"]);e.duplicateLines(2,2),f.equal(e.getValue(),["1","2","3","3"].join("\n"))},"test: duplicate first line":function(){var e=new i(["1","2","3"]);e.duplicateLines(0,0),f.equal(e.getValue(),["1","1","2","3"].join("\n"))},"test: getScreenLastRowColumn":function(){var e=new i(["juhu","12		34","ぁぁa"]);f.equal(e.getScreenLastRowColumn(0),4),f.equal(e.getScreenLastRowColumn(1),10),f.equal(e.getScreenLastRowColumn(2),5)},"test: convert document to screen coordinates":function(){var e=new i("01234	567890	1234");e.setTabSize(4),f.equal(e.documentToScreenColumn(0,0),0),f.equal(e.documentToScreenColumn(0,4),4),f.equal(e.documentToScreenColumn(0,5),5),f.equal(e.documentToScreenColumn(0,6),8),f.equal(e.documentToScreenColumn(0,12),14),f.equal(e.documentToScreenColumn(0,13),16),e.setTabSize(2),f.equal(e.documentToScreenColumn(0,0),0),f.equal(e.documentToScreenColumn(0,4),4),f.equal(e.documentToScreenColumn(0,5),5),f.equal(e.documentToScreenColumn(0,6),6),f.equal(e.documentToScreenColumn(0,7),7),f.equal(e.documentToScreenColumn(0,12),12),f.equal(e.documentToScreenColumn(0,13),14)},"test: convert document to screen coordinates with leading tabs":function(){var e=new i("		123");e.setTabSize(4),f.equal(e.documentToScreenColumn(0,0),0),f.equal(e.documentToScreenColumn(0,1),4),f.equal(e.documentToScreenColumn(0,2),8),f.equal(e.documentToScreenColumn(0,3),9)},"test: documentToScreen without soft wrap":function(){var e=new i(["juhu","12		34","ぁぁa"]);f.position(e.documentToScreenPosition(0,3),0,3),f.position(e.documentToScreenPosition(1,3),1,4),f.position(e.documentToScreenPosition(1,4),1,8),f.position(e.documentToScreenPosition(2,2),2,4)},"test: documentToScreen with soft wrap":function(){var e=new i(["foo bar foo bar"]);e.setUseWrapMode(!0),e.setWrapLimitRange(12,12),e.adjustWrapLimit(80),f.position(e.documentToScreenPosition(0,11),0,11),f.position(e.documentToScreenPosition(0,12),1,0)},"test: documentToScreen with soft wrap and multibyte characters":function(){var e=new i(["ぁぁa"]);e.setUseWrapMode(!0),e.setWrapLimitRange(2,2),e.adjustWrapLimit(80),f.position(e.documentToScreenPosition(0,1),1,0),f.position(e.documentToScreenPosition(0,2),2,0),f.position(e.documentToScreenPosition(0,4),2,1)},"test: documentToScreen should clip position to the document boundaries":function(){var e=new i("foo bar\njuhu kinners");f.position(e.documentToScreenPosition(-1,4),0,0),f.position(e.documentToScreenPosition(3,0),1,12)},"test: convert screen to document coordinates":function(){var e=new i("01234	567890	1234");e.setTabSize(4),f.equal(e.screenToDocumentColumn(0,0),0),f.equal(e.screenToDocumentColumn(0,4),4),f.equal(e.screenToDocumentColumn(0,5),5),f.equal(e.screenToDocumentColumn(0,6),5),f.equal(e.screenToDocumentColumn(0,7),5),f.equal(e.screenToDocumentColumn(0,8),6),f.equal(e.screenToDocumentColumn(0,9),7),f.equal(e.screenToDocumentColumn(0,15),12),f.equal(e.screenToDocumentColumn(0,19),16),e.setTabSize(2),f.equal(e.screenToDocumentColumn(0,0),0),f.equal(e.screenToDocumentColumn(0,4),4),f.equal(e.screenToDocumentColumn(0,5),5),f.equal(e.screenToDocumentColumn(0,6),6),f.equal(e.screenToDocumentColumn(0,12),12),f.equal(e.screenToDocumentColumn(0,13),12),f.equal(e.screenToDocumentColumn(0,14),13)},"test: screenToDocument with soft wrap":function(){var e=new i(["foo bar foo bar"]);e.setUseWrapMode(!0),e.setWrapLimitRange(12,12),e.adjustWrapLimit(80),f.position(e.screenToDocumentPosition(1,0),0,12),f.position(e.screenToDocumentPosition(0,11),0,11),f.position(e.screenToDocumentPosition(0,12),0,11),f.position(e.screenToDocumentPosition(0,20),0,11)},"test: screenToDocument with soft wrap and multi byte characters":function(){var e=new i(["ぁ a"]);e.setUseWrapMode(!0),e.adjustWrapLimit(80),f.position(e.screenToDocumentPosition(0,1),0,0),f.position(e.screenToDocumentPosition(0,2),0,1),f.position(e.screenToDocumentPosition(0,3),0,2),f.position(e.screenToDocumentPosition(0,4),0,3),f.position(e.screenToDocumentPosition(0,5),0,3)},"test: screenToDocument should clip position to the document boundaries":function(){var e=new i("foo bar\njuhu kinners");f.position(e.screenToDocumentPosition(-1,4),0,0),f.position(e.screenToDocumentPosition(0,-1),0,0),f.position(e.screenToDocumentPosition(0,30),0,7),f.position(e.screenToDocumentPosition(2,4),1,12),f.position(e.screenToDocumentPosition(1,30),1,12),f.position(e.screenToDocumentPosition(20,50),1,12),f.position(e.screenToDocumentPosition(20,5),1,12),e.addFold("...",new a(0,1,1,3)),f.position(e.screenToDocumentPosition(1,2),1,12),e.setUseWrapMode(!0),e.setWrapLimitRange(5,5),f.position(e.screenToDocumentPosition(4,1),1,12)},"test: wrapLine split function":function(){function e(e,t,n,s){n=n||12,s=s||4,e=r.stringTrimRight(e);var o=i.prototype.$getDisplayTokens(e),u=i.prototype.$computeWrapSplits(o,n,s);f.ok(u.length==t.length);for(var a=0;a<u.length;a++)f.ok(u[a]==t[a])}e("foo bar foo bar",[12]),e("foo bar f   bar",[12]),e("foo bar f     r",[14]),e("foo bar foo bar foo bara foo",[12,25]),e("foo foo foo 	 	",[]),e("foooooooooooooo",[12]),e("fooooooooooooooooooooooooooo",[12,24]),e("foo bar fooooooooooobooooooo",[8,20]),e("foo 		bar",[6]),e("foo 	 	bar",[7]),e("foo 	 	   	 	 bar",[14]),e("ぁぁ",[1],2),e(" ぁぁ",[1,2],2),e(" ぁ	ぁ",[1,3],2),e(" ぁぁ	ぁ",[1,4],4),e(" ab.c;ef++",[1,3,5,7,8],2),e(" a.b",[1,2,3],1),e("#>>",[1,2],1)},"test get longest line":function(){var e=new i(["12"]);e.setTabSize(4),f.equal(e.getScreenWidth(),2),e.doc.insertNewLine({row:0,column:Infinity}),e.doc.insertLines(1,["123"]),f.equal(e.getScreenWidth(),3),e.doc.insertNewLine({row:0,column:Infinity}),e.doc.insertLines(1,["		"]),f.equal(e.getScreenWidth(),8),e.setTabSize(2),f.equal(e.getScreenWidth(),4)},"test getDisplayString":function(){var e=new i(["12"]);e.setTabSize(4),f.equal(e.$getDisplayTokens("	").length,4),f.equal(e.$getDisplayTokens("abc").length,3),f.equal(e.$getDisplayTokens("abc	").length,4)},"test issue 83":function(){var e=new i(""),t=new s(new u,e),n=e.getDocument();e.setUseWrapMode(!0),n.insertLines(0,["a","b"]),n.insertLines(2,["c","d"]),n.removeLines(1,2)},"test wrapMode init has to create wrapData array":function(){var e=new i("foo bar\nfoo bar"),t=new s(new u,e),n=e.getDocument();e.setUseWrapMode(!0),e.setWrapLimitRange(3,3),e.adjustWrapLimit(80),f.equal(e.$wrapData.length,2),f.equal(e.$wrapData[0].length,1),f.equal(e.$wrapData[1].length,1)},"test first line blank with wrap":function(){var e=new i("\nfoo");e.setUseWrapMode(!0),f.equal(e.doc.getValue(),["","foo"].join("\n"))},"test first line blank with wrap 2":function(){var e=new i("");e.setUseWrapMode(!0),e.setValue("\nfoo"),f.equal(e.doc.getValue(),["","foo"].join("\n"))},"test fold getFoldDisplayLine":function(){function t(t,n){var r=e.getLine(t.end.row),i=e.getFoldDisplayLine(t,t.end.row,r.length);f.equal(i,n)}var e=c();t(e.$foldData[0],"function foo(args...) {"),t(e.$foldData[1],'    for (vfoo...ert(items[bar..."juhu");')},"test foldLine idxToPosition":function(){function t(t,n,r,i){var s=e.$foldData[t];f.position(s.idxToPosition(n),r,i)}var e=c();t(0,12,0,12),t(0,13,0,13),t(0,14,0,13),t(0,19,0,13),t(0,20,0,18),t(1,10,1,10),t(1,11,1,10),t(1,15,1,10),t(1,16,2,10),t(1,26,2,20),t(1,27,2,20),t(1,32,2,25)},"test fold documentToScreen":function(){function t(t,n,r,i){f.position(e.documentToScreenPosition(t,n),r,i)}var e=c();t(0,0,0,0),t(0,13,0,13),t(0,14,0,13),t(0,17,0,13),t(0,18,0,20),t(1,0,1,0),t(1,10,1,10),t(1,11,1,10),t(1,99,1,10),t(2,0,1,10),t(2,9,1,10),t(2,10,1,16),t(2,11,1,17),t(2,19,1,25),t(2,20,1,26),t(2,21,1,26),t(2,24,1,26),t(2,25,1,32),t(2,26,1,33),t(2,99,1,40),t(3,0,2,0)},"test fold screenToDocument":function(){function t(t,n,r,i){f.position(e.screenToDocumentPosition(r,i),t,n)}var e=c();t(0,0,0,0),t(0,13,0,13),t(0,13,0,14),t(0,18,0,20),t(0,19,0,21),t(1,0,1,0),t(1,10,1,10),t(1,10,1,11),t(1,10,1,15),t(2,10,1,16),t(2,11,1,17),t(2,19,1,25),t(2,20,1,26),t(2,20,1,27),t(2,20,1,31),t(2,25,1,32),t(2,26,1,33),t(2,33,1,99),t(3,0,2,0)},"test getFoldsInRange()":function(){function r(t,n,r,i,s){var o=new a(t,n,r,i),u=e.getFoldsInRange(o);f.ok(u.length==s.length);for(var l=0;l<u.length;l++)f.equal(u[l].range+"",s[l].range+"")}var e=c(),t=e.$foldData,n=t[0].folds.concat(t[1].folds);r(0,0,0,13,[]),r(0,0,0,14,[n[0]]),r(0,0,0,18,[n[0]]),r(0,0,1,10,[n[0]]),r(0,0,1,11,[n[0],n[1]]),r(0,18,1,11,[n[1]]),r(2,0,2,13,[n[1]]),r(2,10,2,20,[]),r(2,10,2,11,[]),r(2,19,2,20,[])},"test fold one-line text insert":function(){function r(t,n,r){e.insert({row:t,column:n},r),e.$syncInformUndoManager()}var e=c(),t=e.getUndoManager(),n=e.$foldData,i,s,o;i=e.$foldData[0],s=i.folds[0],r(0,0,"0"),f.range(i.range,0,14,0,19),f.range(s.range,0,14,0,19),r(0,14,"1"),f.range(i.range,0,15,0,20),f.range(s.range,0,15,0,20),r(0,20,"2"),f.range(i.range,0,15,0,20),f.range(s.range,0,15,0,20),i=e.$foldData[1],o=i.folds,r(1,0,"3"),f.range(i.range,1,11,2,25),f.range(o[0].range,1,11,2,10),f.range(o[1].range,2,20,2,25),r(1,11,"4"),f.range(i.range,1,12,2,25),f.range(o[0].range,1,12,2,10),f.range(o[1].range,2,20,2,25),r(2,10,"5"),f.range(i.range,1,12,2,26),f.range(o[0].range,1,12,2,10),f.range(o[1].range,2,21,2,26),r(2,21,"6"),f.range(i.range,1,12,2,27),f.range(o[0].range,1,12,2,10),f.range(o[1].range,2,22,2,27),r(2,27,"7"),f.range(i.range,1,12,2,27),f.range(o[0].range,1,12,2,10),f.range(o[1].range,2,22,2,27),t.undo(),f.range(i.range,1,12,2,27),f.range(o[0].range,1,12,2,10),f.range(o[1].range,2,22,2,27),t.undo(),f.range(i.range,1,12,2,26),f.range(o[0].range,1,12,2,10),f.range(o[1].range,2,21,2,26),t.undo(),f.range(i.range,1,12,2,25),f.range(o[0].range,1,12,2,10),f.range(o[1].range,2,20,2,25),t.undo(),f.range(i.range,1,11,2,25),f.range(o[0].range,1,11,2,10),f.range(o[1].range,2,20,2,25),t.undo(),f.equal(n.length,2),f.range(n[0].range,0,15,0,20),f.range(n[1].range,1,10,2,25),i=e.$foldData[0],s=i.folds[0],t.undo(),f.range(i.range,0,15,0,20),f.range(s.range,0,15,0,20),t.undo(),f.range(i.range,0,14,0,19),f.range(s.range,0,14,0,19),t.undo(),f.range(i.range,0,13,0,18),f.range(s.range,0,13,0,18)},"test fold multi-line insert/remove":function(){function r(t,n,r){e.insert({row:t,column:n},r),e.$syncInformUndoManager()}var e=c(),t=e.getUndoManager(),n=e.$foldData,n=e.$foldData,i,s,o;r(0,0,"\nfo0"),f.equal(n.length,2),f.range(n[0].range,1,16,1,21),f.range(n[1].range,2,10,3,25),r(2,0,"\nba1"),f.equal(n.length,2),f.range(n[0].range,1,16,1,21),f.range(n[1].range,3,13,4,25),r(3,10,"\nfo2"),f.equal(n.length,2),f.range(n[0].range,1,16,1,21),f.range(n[1].range,4,6,5,25),r(5,10,"\nba3"),f.equal(n.length,3),f.range(n[0].range,1,16,1,21),f.range(n[1].range,4,6,5,10),f.range(n[2].range,6,13,6,18),r(6,18,"\nfo4"),f.equal(n.length,3),f.range(n[0].range,1,16,1,21),f.range(n[1].range,4,6,5,10),f.range(n[2].range,6,13,6,18),t.undo(),f.equal(n.length,3),f.range(n[0].range,1,16,1,21),f.range(n[1].range,4,6,5,10),f.range(n[2].range,6,13,6,18),t.undo(),f.equal(n.length,2),f.range(n[0].range,1,16,1,21),f.range(n[1].range,4,6,5,25),t.undo(),f.equal(n.length,2),f.range(n[0].range,1,16,1,21),f.range(n[1].range,3,13,4,25),t.undo(),f.equal(n.length,2),f.range(n[0].range,1,16,1,21),f.range(n[1].range,2,10,3,25),t.undo(),f.equal(n.length,2),f.range(n[0].range,0,13,0,18),f.range(n[1].range,1,10,2,25)},"test fold wrap data compution":function(){function e(e,t){f.ok(e.length==t.length);for(var n=0;n<e.length;n++)f.equal(e[n],t[n])}function t(t,n,r){t&&e(o[0],t),n&&e(o[1],n),r&&e(o[2],r)}function n(e,n,r,i,o){s.removeFold(s.getFoldAt(e,n)),t(r,i,o)}var r=["foo bar foo bar","foo bar foo bar","foo bar foo bar"],s=new i(r.join("\n"));s.setUseWrapMode(!0),s.$wrapLimit=7,s.$updateWrapData(0,2);var o=s.$wrapData;return t([8],[8],[8]),s.addFold("woot",new a(0,4,0,15)),t([4],[8],[8]),n(0,4,[8],[8],[8]),s.addFold("woot",new a(0,6,0,9)),t([6,13],[8],[8]),n(0,6,[8],[8],[8]),s.addFold("woot",new a(0,3,0,15)),t([],[8],[8]),n(0,4,[8],[8],[8]),s.addFold("woot",new a(0,8,0,15)),t([8],[8],[8]),n(0,8,[8],[8],[8]),s.addFold("woot0123456789",new a(0,8,0,15)),t([8],[8],[8]),n(0,8,[8],[8],[8]),s.addFold("woot0123456789",new a(0,6,0,8)),t([6,20],[8],[8]),n(0,8,[8],[8],[8]),s.addFold("woot0123456789",new a(0,6,0,8)),s.addFold("woot0123456789",new a(0,8,0,10)),t([6,20,34],[8],[8]),s.removeFold(s.getFoldAt(0,7)),n(0,8,[8],[8],[8]),s.addFold("woot0123456789",new a(0,7,0,9)),s.addFold("woot0123456789",new a(0,13,0,15)),t([7,21,25],[8],[8]),s.removeFold(s.getFoldAt(0,7)),n(0,14,[8],[8],[8]),s.addFold("woot",new a(0,8,1,15)),t([8],[8],[8]),n(0,8,[8],[8],[8]),s.addFold("woot",new a(0,9,1,11)),t([8,14],[8],[8]),n(0,9,[8],[8],[8]),s.addFold("woot",new a(0,9,1,15)),t([8],[8],[8]),n(0,9,[8],[8],[8]),s},"test add fold":function(){function n(n,r,i){var s=!1;try{t=e.addFold(n,r)}catch(o){s=!0}if(s!=i)throw"Expected to get an exception"}var e=c(),t;n("foo",new a(0,13,0,17),!1),n("foo",new a(0,14,0,18),!0),n("foo",new a(0,13,0,18),!1),f.equal(e.$foldData[0].folds.length,1),n("f",new a(0,13,0,18),!0),n("foo",new a(0,18,0,21),!1),f.equal(e.$foldData[0].folds.length,2),e.removeFold(t),n("foo",new a(0,18,0,22),!1),n("foo",new a(0,18,0,19),!0),n("foo",new a(0,22,1,10),!1)},"test add subfolds":function(){var e=c(),t,n,r=e.$foldData;n=r[0].folds[0],t=e.addFold("fold0",new a(0,10,0,21)),f.equal(r[0].folds.length,1),f.equal(t.subFolds.length,1),f.equal(t.subFolds[0],n),e.expandFold(t),f.equal(r[0].folds.length,1),f.equal(r[0].folds[0],n),f.equal(t.subFolds.length,0),t=e.addFold("fold0",new a(0,13,2,10)),f.equal(r.length,1),f.equal(t.subFolds.length,2),f.equal(t.subFolds[0],n),e.expandFold(t),f.equal(r.length,2),f.equal(r[0].folds.length,1),f.equal(r[0].folds[0],n),f.equal(t.subFolds.length,0),e.unfold(null,!0),t=e.addFold("fold0",new a(0,0,0,21)),e.addFold("fold0",new a(0,1,0,5)),e.addFold("fold0",new a(0,6,0,8)),f.equal(t.subFolds.length,2)}}}),typeof module!="undefined"&&module===require.main&&require("asyncjs").test.testcase(module.exports).exec();